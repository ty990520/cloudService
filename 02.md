# 가상화
클라우드 컴퓨팅은 가상화 기술을 사용하여 자원들에 접근한다.


## 가상화란?
- 다수의 운영체계 또는 어플리케이션 이미지가 물리 서버를 공유하도록 하여 총소유비용을 절감하고 관리성을 개선할 수 있게 하는 기술
- 모든 불특정 다수의 사람들이 개인 레벨의 저장 장치를 가지고 있는 것처럼 인식할 수 있도록 함
- 물리적인 컴포넌트(HW장치)를 논리적인 객체로 추상화하는 것을 의미. 마치 하나의 장치를 여러 개처럼 동작시키거나, 반대로 여러 개의 장치를 묶어 하나의 장치인 것 처럼 사용할 수 있는 기술
- 가상화의 대상이 되는 컴퓨팅 자원은 CPU, 메모리, 스토리지, 네트워크, GPU가 있으며, 이들로 구성된 서버나 장치들을 가상화함으로써 높은 수준의 자원 사용률과 분산 처리 기능을 얻을 수 있음
- 개인 로컬의 디렉토리인 것 처럼 인식하게 하여 사용에 불편함이 없게 함 
HW 가상화 - 서버, 네트워크, 스토리지
OS 가상화 (컨테이너 가상화) 등

예) OneDrive


## 가상화 특성
* 접근성 : 클라이언트는 어떤 장소에서든지 서비스로의 접근을 요청 가능
* 응용성 : 클라우드 컴퓨팅은 여러 개의 어플리케이션 인스턴스를 가지고 있고, 조건에 맞는 인스턴스를 직접 요청
  * 인스턴스는 프로그램의 개념과 비슷하다.
* CPU : 컴퓨터는 작업량을 할당받은 각 머신을 가상 머신의 집합 안으로 분할할 수 있음. 그렇지 않으면 시스템은 로드밸런싱 기술을 통해 가상화 가능
  * 로드밸런싱 :  둘 혹은 셋이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것을 의미 (병목현상 예방)
* 저장성 : 데이터는 저장장치를 교차해서 저장되고, 백업을 위해 복제됨


<BR>
 
## 가상화 종류
### (1) 서버 가상화(Server Virtualization)
- 서버의 효율성을 높이기 위해 등장한 기술로 가상화 개념의 시초
- 하드웨어를 가상화하기 위해서는 하드웨어뿐만 아니라 각각의 가상머신들을 관리할 가상머신모니터와 같은 중간 관리자가 필요
- 이를 하이퍼바이저라고 하며 VM이 동작할 수 있는 환경을 제공 (하드웨어와 가상머신 간의 인터프린터 역할을 해줌)
- 사용자들의 필요에 따라 하이퍼바이저가 각각의 독립된 공간분리된 복수개의 가상머신을 만듦

### (2) 데스크탑 가상화(Virtual Desktop Infrastructure, VDI)
- 데이터 센터의 서버에서 운영되는 가상의 pc환경을 의미
- 가상의 데스크탑을 마치 로컬 시스템처럼 활용할 수 있으며, 모든 작업의 프로세싱과 저장은 데이터 센터에 위치한 서버에서 처리됨

### (3) 어플리케이션 가상화(Application Virtualization)
- 해당 응용 프로그램이 실행되는 운영체제로부터 응용 소프트웨어를 캡슐화하는 기법
- 응용프로그램은 실제 설치되지는 않으나 마치 설치된 것 처럼 실행됨

<BR><BR>
 
## 하이퍼바이저 (VMM)
- 교통정리해주는 프로그램
* 가상머신에 물리시스템 자원에 대한 접근을 제공하는 프로그램
  * 가상머신 : 컴퓨터를 에뮬레이션하는 소프트웨어


### 하이퍼바이저의 유형
<img src="https://user-images.githubusercontent.com/48792230/111893636-75499600-8a47-11eb-9e82-8fcdc96924f4.PNG">
<img src="https://user-images.githubusercontent.com/48792230/111893632-7084e200-8a47-11eb-8cec-4df34a49f478.png">

- Type1하이퍼바이저 : 하드웨어 위에 운영체제 없이 바로 하이퍼바이저가 install. 그 위에서 VM이 동작 가능함(복수개 가능)
  - Bare-metal기반
- Type2하이퍼바이저 : 하드웨어 위에 주 운영체제(Host OS)가 있고 그 위에 하이퍼바이저를 install. 하이퍼바이저 위에서 VM이 동작 가능함(복수개 가능)
  - Host OS 위에서 하이퍼바이저가 다른 응용 프로그램처럼 동작함
<BR>

* Type1하이퍼바이저는 하드웨어에 직접 전달을 해야하기 때문에 Type2하이퍼바이저보다 전문영역이고 각 하드웨어마다 세팅하는 것이 까다로움<br>
* 그러나 운영체제를 거칠 필요가 없기 때문에 성능은 Type1하이퍼바이저가 더 뛰어남<br>
* Type2하이퍼바이저는 기존의 컴퓨터 환경에서 활용하는 것이기 때문에 설치가 용이하고 구성이 편리함<br>
<BR><BR>

## 하드웨어 리소스에 따른 가상화 종류
(1) CPU 가상화
- 각각의 가상머신(VM)에 동적인 vCPU(Virtual CPU) 할당
* 하이퍼스레딩: CPU 제조사인 인텔의 기술로 CPU내 각 코어의 연산을 병렬화하여 두 개의 논리적 코어로 동작하도록 하는 기술


(2) 메모리 가상화
- VM에 메모리 영역을 할당하고, 연속된 물리적 메모리가 존재하는 것처럼 인식
- 가상머신에 물리 메모리의 특정 영역을 필요한 용량만큼 할당하고, 페이징(Paging) 및 메모리 압축
등의 기법을 통해 관리
* 페이징: 컴퓨터가 데이터를 2차 기억 장치에서 메인 메모리로 가져와 사용하기 위한 저장 및 검색 메
모리 관리 기법으로 가상기억장치를 모두 같은 크기의 블록으로 편성하여 운용

(3) 스토리지 가상화
- 가상머신(VM)에 저장소를 할당하며 직접 연결된 디스크처럼 인식
- 물리 디스크의 특정 영역을 필요한 용량만큼 할당하고, 해당 영역에 접근 및 읽기, 쓰기 권한을 제공

(4) 네트워크 가상화
- 컴퓨터가 여러 네트워크 인터페이스를 보유한 것처럼 인식
- 라우터(Router), 스위치(Switch), 터미널(Terminal) 등의 네트워크 중계 기기 및 단말의 가상화를 통해 가상의 네트워크를 만들고 서로 다른 프로토콜도 공존할 수 있도록 함

(5) 스토리지 영역 네트워크 (SAN, Storage Area Network)
- 특정 서버나 저장소에 데이터 저장 요구가 많아지는 경우, 상대적으로 저장 공간이 남아 있는 저장소에 분산 저장
- 물리적 저장 디바이스를 가상화하여 스토리지 리소스의 가용성과 유연성 향상
<BR>
 
> 그저 '가상화'를 통해 CPU, 메모리, 스토리지, NW 등을 분산,병렬처리하여 동적으로 유연하게 사용할 수 있다는 것을 알면 됨

<BR>
 
## 가상화 방식에 따른 가상화 종류
### 전가상화
<img src="https://user-images.githubusercontent.com/48792230/111893638-77135980-8a47-11eb-8161-7f930fbdc849.PNG">

- type2하이퍼바이저와 방식이 유사
- 게스트 OS 스스로가 게스트 OS인 것을 알지 못하는 상태. 즉 자신이 하드웨어에 대한 통제권을 쥐고 있다고 인식
- 하이퍼바이저가 하드웨어에 에뮬레이현 해준 형태
- 게스트 OS에 대한 별다른 수정 없이 구동이 가능
<BR>

> VM별로 각각의 언어(LINUX,MAX,WINDOW등등..)를 가지는데 하이퍼바이저가 각각의 언어를 번역할 수 있는 만능의 역할을 함.
VM은 하이퍼바이저의 번역(전달)과정을 알지못하고 자신이 직접 HW와 연결되어 있다고 인식하게 됨
<BR>

### 반가상화
<img src="https://user-images.githubusercontent.com/48792230/111893641-78dd1d00-8a47-11eb-81ce-3dedd9644823.PNG">

- type1하이퍼바이저와 방식이 유사
- 하이퍼바이저(VMM)가 호스트 OS가 아닌 하드웨어 위에서 직접 실행되기 때문에 '네이티브(Native, Bare-metal)가상화'라고도 함
- 하드웨어에 대한 제어권을 게스트 OS가 아닌 하이퍼바이저가 가지고 있음
- 하드웨어와의 I/O 처리에 있어서 전가상화보다 직접적인 루틴을 사용
- 처리 단계가 간단하기 때문에 성능은 전가상화 대비 높은 편
<BR>

> VM자체가 약간의 OS명령어를 커널에 가지고 있어서 자체적으로 수정(번역) 후 하이퍼바이저에게 전달해줌.
하이퍼바이저는 교통정리 후에 하드웨어에 넘겨줌(하이퍼바이저는 교통정리의 역할만 하기 때문에 처리 단계가 간단하여 성능이 우수함)
<BR>


## 컨테이너와 도커
<img src="https://user-images.githubusercontent.com/48792230/111894272-ed668a80-8a4c-11eb-9bc2-744ed3b60216.png" width="500" height="450"><br>
* Docker(항구) : 환경을 설정해놓는 것
* Container :모듈화되고 격리된 컴퓨팅 공간 또는 컴퓨팅 환경, 다시 말해 어플리케이션을 구동하는 환경을 격리한 공간을 의미
* 미리 설정해놓은 docker환경에 맞는 컨테이너를 docking(or porting)해서 설치할 수 있도록 함
<br>

### 컨테이너의 효과
* 네트워크, 스토리지, 보안 등 각 영역마다 정책이 서로 다르기 때문에 컴퓨터 프로그램들은 환경이 바뀔 때마다 각종 오류가 발생. 이는 소프트웨어 개발자들의 오랜 골칫거리. 따라서 소프트웨어가 현재의 컴퓨팅 환경에서 다른 환경으로 이동하더라도 안정적으로 실행할 수 있음
* 기본적으로 가상화를 위해 하이퍼바이저와 게스트 OS가 필요했던 것과는 달리, 컨테이너는 운영 체제를 제외하고 어플리케이션 실행에 필요한 모든 파일만을 패키징(Packaging)한 형태. 그만큼 기존의 가상머신에 비해 가볍고 빠르게 동작이 가능


> 최근 클라우드 컴퓨팅에서는 컨테이너 기반 가상화가 기존의 하이퍼바이저 기반의 가상화 기술을 대체하며 각광받고 있음

